<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />

    <title>Carrito</title>
  </head>

  <body>
    <div class="container text-center my-3">
      <table>
        <tbody id="usuario"></tbody>
      </table>
      <div class="jumbotron" style="background-color: green; color: white">
        <h1>CARRITO</h1>
        <h2>Estos son tus productos</h2>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th>Nombre:</th>
            <th>Precio:</th>
            <th>Descripci√≥n:</th>
            <th>thumbnailn:</th>
          </tr>
        </thead>
        <tbody id="productsTable"></tbody>
      </table>
    </div>
  </body>
</html>

<script>
  const $ = document.querySelector.bind(document);
  fetch('/login')
  .then( res => res.json() ) 
  .then( data => displayUser(data.firstName, data.imageUrl, data.carts[data.carts.length-1]) )
  .then( html =>  $('#usuario').innerHTML = html )
  .catch( error => {
    console.log(error);
    // Si no hay un usuario loggeado redirecciona a login:
    //window.location.href = '/login.html';
  })
;
  const displayUser = (nombre, avatar, cartId) => {
    fetchProducts(`/api/carts/products/${cartId}`);
    return
    `
      <h5>Usuario ${nombre}</h5>
      <img style="width: 5rem" src="${avatar} />
      `;
  };
  const tableRows = (products) => {
    return products.map(
      (prod) =>
        `        
        <tr>
        <td><p>${prod.title}</p></td>
        <td><p>${prod.price}</p></td>
        <td>${prod.description}</td>
        <td><img style="width:5rem" src=${prod.thumbnail}></td>
        </tr>
      `
    );  //.join(" ");
  };
  const fetchProducts = (cartId) => { fetch(`${cartId}`)
    .then(res => res.json())
    .then(products => tableRows(products))
    .then(html => $("#productsTable").innerHTML = html)
    .catch(error => console.log(error));
  }
  /*fetch('/login')
    .then( res => res.json() ) 
    .then(res => console.log(res))
    .then( data => displayUser(data.username, data.imageUrl, data.carts[data.carts.length-1]) )
    .then( html =>  $('#userData').innerHTML = html )
    .catch( error => console.log(error) )*/
;

</script>
